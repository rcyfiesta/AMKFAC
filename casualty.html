<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Casualty View</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Casualty View</h1>

    <label>Scenario Number</label>
    <select id="scenarioNumberSelect">
        <option value="">-- Select Scenario --</option>
    </select>

    <label>Casualty Name</label>
    <select id="casualtyNameSelect">
        <option value="">-- Select Casualty --</option>
    </select>

    <div id="casualtyInfo">
        <p><strong>Scenario:</strong> <span id="displayScenario"></span></p>
        <p><strong>Casualty:</strong> <span id="displayCasualty"></span></p>
        <p><strong>Injuries:</strong> <span id="displayInjuries"></span></p>
        <p><strong>What Happened:</strong> <span id="displayWhatHappened"></span></p>
        <p><strong>Medical History:</strong> <span id="displayMedicalHistory"></span></p>
        <p><strong>Drug Allergies:</strong> <span id="displayAllergies"></span></p>
        <p><strong>Last Meal:</strong> <span id="displayLastMeal"></span></p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, query, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "YOUR_API_KEY",
          authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
          projectId: "YOUR_PROJECT_ID",
          storageBucket: "YOUR_PROJECT_ID.appspot.com",
          messagingSenderId: "YOUR_SENDER_ID",
          appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const scenarioSelect = document.getElementById("scenarioNumberSelect");
        const casualtySelect = document.getElementById("casualtyNameSelect");

        const displayScenario = document.getElementById("displayScenario");
        const displayCasualty = document.getElementById("displayCasualty");
        const displayInjuries = document.getElementById("displayInjuries");
        const displayWhatHappened = document.getElementById("displayWhatHappened");
        const displayMedicalHistory = document.getElementById("displayMedicalHistory");
        const displayAllergies = document.getElementById("displayAllergies");
        const displayLastMeal = document.getElementById("displayLastMeal");

        // Store all scenarios locally
        let allScenarios = [];

        // Listen to all scenarios in Firestore
        const q = query(collection(db, "scenarios"));
        onSnapshot(q, snapshot => {
            allScenarios = [];
            snapshot.forEach(doc => allScenarios.push(doc.data()));

            // Populate scenario dropdown (unique scenario numbers)
            const scenarioNumbers = [...new Set(allScenarios.map(s => s.scenarioNumber))];
            scenarioSelect.innerHTML = '<option value="">-- Select Scenario --</option>';
            scenarioNumbers.forEach(num => {
                const option = document.createElement("option");
                option.value = num;
                option.textContent = num;
                scenarioSelect.appendChild(option);
            });

            // Trigger casualty update if scenario already selected
            updateCasualtyOptions();
        });

        // Update casualty dropdown based on selected scenario
        function updateCasualtyOptions() {
            const selectedScenario = scenarioSelect.value;
            const casualties = allScenarios
                .filter(s => s.scenarioNumber === selectedScenario)
                .map(s => s.casualtyName);
            const uniqueCasualties = [...new Set(casualties)];

            casualtySelect.innerHTML = '<option value="">-- Select Casualty --</option>';
            uniqueCasualties.forEach(name => {
                const option = document.createElement("option");
                option.value = name;
                option.textContent = name;
                casualtySelect.appendChild(option);
            });

            // Clear display when scenario changes
            displayScenario.textContent = '';
            displayCasualty.textContent = '';
            displayInjuries.textContent = '';
            displayWhatHappened.textContent = '';
            displayMedicalHistory.textContent = '';
            displayAllergies.textContent = '';
            displayLastMeal.textContent = '';
        }

        scenarioSelect.addEventListener('change', updateCasualtyOptions);

        // Display info when casualty selected
        casualtySelect.addEventListener('change', () => {
            const selectedScenario = scenarioSelect.value;
            const selectedCasualty = casualtySelect.value;
            const data = allScenarios.find(s => s.scenarioNumber === selectedScenario && s.casualtyName === selectedCasualty);

            if(data) {
                displayScenario.textContent = data.scenarioNumber;
                displayCasualty.textContent = data.casualtyName;
                displayInjuries.textContent = data.injuries;
                displayWhatHappened.textContent = data.whatHappened;
                displayMedicalHistory.textContent = data.medicalHistory;
                displayAllergies.textContent = data.allergies;
                displayLastMeal.textContent = data.lastMeal;
            }
        });

    </script>
</body>
</html>