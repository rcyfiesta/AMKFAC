<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Feedback Interface</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<h1>Trainer Feedback</h1>

<div id="feedbackSection"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getFirestore, collection, query, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBvJpARNfHPu8j8E99_3CIsNbSBVzBCFQA",
  authDomain: "amkfac-c85a0.firebaseapp.com",
  projectId: "amkfac-c85a0",
  storageBucket: "amkfac-c85a0.firebasestorage.app",
  messagingSenderId: "320355813529",
  appId: "1:320355813529:web:a2e979ad989f95acbb5008"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const feedbackSection = document.getElementById("feedbackSection");

const q = query(collection(db, "scenarios"));
onSnapshot(q, snapshot => {
    feedbackSection.innerHTML = ""; // clear previous

    snapshot.forEach(docSnap => {
        const data = docSnap.data();

        const container = document.createElement("div");
        container.style.border = "1px solid #ccc";
        container.style.padding = "10px";
        container.style.marginBottom = "15px";

        const scenarioTitle = document.createElement("h2");
        scenarioTitle.textContent = `Scenario: ${data.scenarioNumber} | Casualty: ${data.casualtyName}`;
        container.appendChild(scenarioTitle);

        if (data.injuries) {
            data.injuries.forEach(injury => {
                const injuryDiv = document.createElement("div");
                injuryDiv.style.borderTop = "1px dashed #888";
                injuryDiv.style.paddingTop = "5px";
                injuryDiv.style.marginTop = "5px";

                const injuryTitle = document.createElement("h3");
                injuryTitle.textContent = `Injury: ${injury}`;
                injuryDiv.appendChild(injuryTitle);

                // Unticked rubric items
                const rubricItems = data.rubric?.[injury] || [];
                const unticked = rubricItems.filter(item => !item.checked);
                if (unticked.length > 0) {
                    const ul = document.createElement("ul");
                    unticked.forEach(item => {
                        const li = document.createElement("li");
                        li.textContent = item.criteria;
                        ul.appendChild(li);
                    });
                    injuryDiv.appendChild(document.createTextNode("Unticked Treatments:"));
                    injuryDiv.appendChild(ul);
                } else {
                    injuryDiv.appendChild(document.createTextNode("All treatments ticked."));
                }

                // Feedback
                const feedbackText = data.feedback?.[injury] || "";
                const fbPara = document.createElement("p");
                fbPara.innerHTML = `<strong>Trainer Feedback:</strong> ${feedbackText}`;
                injuryDiv.appendChild(fbPara);

                container.appendChild(injuryDiv);
            });
        }

        feedbackSection.appendChild(container);
    });
});
</script>
</body>
</html>