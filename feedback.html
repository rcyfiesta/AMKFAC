<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Trainer Feedback</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<h1>Trainer Feedback</h1>

<div id="feedbackContainer"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getFirestore, collection, query, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBvJpARNfHPu8j8E99_3CIsNbSBVzBCFQA",
  authDomain: "amkfac-c85a0.firebaseapp.com",
  projectId: "amkfac-c85a0",
  storageBucket: "amkfac-c85a0.firebasestorage.app",
  messagingSenderId: "320355813529",
  appId: "1:320355813529:web:a2e979ad989f95acbb5008"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const feedbackContainer = document.getElementById("feedbackContainer");

const q = query(collection(db, "scenarios"));

onSnapshot(q, snapshot => {
    feedbackContainer.innerHTML = ""; // clear previous content
    snapshot.forEach(docSnap => {
        const data = docSnap.data();

        // Skip if no feedback or no rubric status
        if (!data.feedback && !data.rubric) return;

        const scenarioDiv = document.createElement("div");
        scenarioDiv.style.border = "2px solid #444";
        scenarioDiv.style.padding = "10px";
        scenarioDiv.style.marginBottom = "15px";

        const scenarioHeader = document.createElement("h2");
        scenarioHeader.textContent = `Scenario: ${data.scenarioNumber}`;
        scenarioDiv.appendChild(scenarioHeader);

        const casualtyHeader = document.createElement("h3");
        casualtyHeader.textContent = `Casualty: ${data.casualtyName}`;
        scenarioDiv.appendChild(casualtyHeader);

        const injuries = data.injuries || [];
        injuries.forEach(injury => {
            const injuryDiv = document.createElement("div");
            injuryDiv.style.margin = "10px 0";
            injuryDiv.innerHTML = `<strong>Injury:</strong> ${injury}`;

            // Show feedback if exists
            if (data.feedback && data.feedback[injury]) {
                const fb = document.createElement("p");
                fb.innerHTML = `<strong>Feedback:</strong> ${data.feedback[injury]}`;
                injuryDiv.appendChild(fb);
            }

            // Show unticked rubric criteria
            if (data.rubric && data.rubric[injury]) {
                const rubricList = document.createElement("ul");
                rubricList.style.marginLeft = "20px";
                data.rubric[injury].forEach(item => {
                    // Show only unticked
                    if (!item.checked) {
                        const li = document.createElement("li");
                        li.textContent = item.criteria;
                        rubricList.appendChild(li);
                    }
                });
                if (rubricList.childElementCount > 0) {
                    const rubricHeader = document.createElement("p");
                    rubricHeader.innerHTML = "<strong>Unticked Criteria:</strong>";
                    injuryDiv.appendChild(rubricHeader);
                    injuryDiv.appendChild(rubricList);
                }
            }

            scenarioDiv.appendChild(injuryDiv);
        });

        feedbackContainer.appendChild(scenarioDiv);
    });
});
</script>

</body>
</html>