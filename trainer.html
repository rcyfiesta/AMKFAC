<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Trainer View</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Trainer View</h1>

    <label>Scenario Number</label>
    <input type="text" id="scenarioNumberInputTrainer">

    <label>Casualty Name</label>
    <input type="text" id="casualtyNameInputTrainer">

    <div id="trainerInfo">
        <p><strong>Scenario:</strong> <span id="displayScenarioTrainer"></span></p>
        <p><strong>Casualty:</strong> <span id="displayCasualtyTrainer"></span></p>
        <p><strong>Injuries:</strong> <span id="displayInjuriesTrainer"></span></p>
        <p><strong>What Happened:</strong> <span id="displayWhatHappenedTrainer"></span></p>
        <p><strong>Medical History:</strong> <span id="displayMedicalHistoryTrainer"></span></p>
        <p><strong>Drug Allergies:</strong> <span id="displayAllergiesTrainer"></span></p>
        <p><strong>Last Meal:</strong> <span id="displayLastMealTrainer"></span></p>

        <button id="pushToCasualty">Push Info To Casualty</button>
    </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getFirestore, collection, query, onSnapshot, doc, updateDoc } 
from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBvJpARNfHPu8j8E99_3CIsNbSBVzBCFQA",
  authDomain: "amkfac-c85a0.firebaseapp.com",
  projectId: "amkfac-c85a0",
  storageBucket: "amkfac-c85a0.firebasestorage.app",
  messagingSenderId: "320355813529",
  appId: "1:320355813529:web:a2e979ad989f95acbb5008"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const scenarioInput = document.getElementById("scenarioNumberInputTrainer");
const casualtyInput = document.getElementById("casualtyNameInputTrainer");

const displayScenario = document.getElementById("displayScenarioTrainer");
const displayCasualty = document.getElementById("displayCasualtyTrainer");
const displayInjuries = document.getElementById("displayInjuriesTrainer");
const displayWhatHappened = document.getElementById("displayWhatHappenedTrainer");
const displayMedicalHistory = document.getElementById("displayMedicalHistoryTrainer");
const displayAllergies = document.getElementById("displayAllergiesTrainer");
const displayLastMeal = document.getElementById("displayLastMealTrainer");

const pushButton = document.getElementById("pushToCasualty");

let currentDocId = null;

const q = query(collection(db, "scenarios"));

onSnapshot(q, snapshot => {
    snapshot.forEach(document => {
        const data = document.data();

        if (
            data.scenarioNumber === scenarioInput.value.trim() &&
            data.casualtyName === casualtyInput.value.trim()
        ) {
            currentDocId = document.id;

            displayScenario.textContent = data.scenarioNumber;
            displayCasualty.textContent = data.casualtyName;
            displayInjuries.textContent = data.injuries?.join(", ");
            displayWhatHappened.textContent = data.whatHappened;
            displayMedicalHistory.textContent = data.medicalHistory;
            displayAllergies.textContent = data.allergies;
            displayLastMeal.textContent = data.lastMeal;
        }
    });
});

pushButton.addEventListener("click", async () => {
    if (!currentDocId) {
        alert("Scenario not found.");
        return;
    }

    const ref = doc(db, "scenarios", currentDocId);

    await updateDoc(ref, {
        "visibility.injuries": true,
        "visibility.whatHappened": true,
        "visibility.medicalHistory": true,
        "visibility.allergies": true,
        "visibility.lastMeal": true
    });

    alert("âœ… Info pushed to casualty!");
});
</script>

</body>
</html>